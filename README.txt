微信考勤系统项目规划

1 系统采用分层架构
        1   界面层
        2        业务逻辑层        
        3   数据逻辑层
        4   数据层

数据层

提供对原始文件的读写和追加 对外提供一个接口 负责对数据的继承操作 不负责数据的逻辑处理 

接口类  操作对象 操作类型 操作参数
DataLayerInterface(filename,’type’,{key:item…})
接口类的成员函数
read();
Write();
Add();

接口类的成员类 
Read类
Read函数 参数1为文件名 字符串类型 原子操作要么成功 要么失败
参数2 为字典 键值为表中的键值 字典的值为选项 一个选项对应表中的一行
如找到名字为张三的人的所有信息 那么名字就是键 而张三就是选项 返回该表中张三所在行的信息 
该字典可有多个键返回多个满足选项的信息 实现了通配符功能
当键值为空时返回文件所有信息
若文件名不存在则返回None 调用成功返回一个字典
Write类
Write函数 参数1为文件名 字符串类型
参数2为字典 每一个键对应表中的一行信息 
先读取文件的所有信息到一个字典中 再把参数字典加入到该字典中 覆盖掉主键相同的一行 然后写入到文本 该函数一般用来创建新文件，但是当外部内容与内部内容有重复时调用该函数可以达到覆盖的目的。若某一项的键值全部为空则表示删除该行。
该函数返回值操作成功为真操作失败返回假
Add类
Add函数 参数1文件名 字符串类型
参数2为字典 把字典中的内容追加到文本最后 该函数用于向已存在的文本添加信息，该函数无法覆盖掉主键相同的两行，不能去重。若某一行为空则表示操作失败无法添加。
若文本不存在则返回False 否则返回True


数据逻辑层

该层对用户指令的有效性进行验证和处理

接口函数: 
去重 就是设定一个一个或者主键 把这些主键的值作为一个键 利用二层循环判断外部数据的键和内部数据的键是否有相同的 若相同则覆盖 若不相同则吧计
数器置1 并打断循环 把该键对应的数据加入内部数据
参数1 是内部数据 参数2是外部数据 参数3 是主键的列表

数据检查函数 参数1 被检查的数据 参数2 检查的格式 字典可以为缺省值
参数3为错误信息字典

默认数据检查函数 检查每一行是否有缺省值或者有多余的数据

正则数据检查函数 利用正则表达式对数据进行核对

Update 
参数 1 文件名 
参数 2 操作类型1可以是 覆盖重复内容 也可以删除重复的内容 判断两个参数是否相同的标准就是对应key值是否全部相等 

参数 3 外部数据

参数4 给出的主键

查询类Query构造参数
参数1 用户ID 提供该操作的用户的用户ID 用来验证是否有权限对该文件进行读取 字符串类型
参数2参数 表明对文件的查询参数 参数为字典代表从某一文件中查找与该字典匹配的信息 改参数为空代表验证文件是否存在 
参数3 表示查询的文件名 文件名为空但是参数不为空代表查询该参数出现在哪个文件中。当参数中有多于的键时若该键的值为*代表不用管该键 当为?代表只能匹配一次 当该键指定值但是文件中不存在该键则不匹配



Get_keys 参数1  文件名
操作过程 函数返回文件的所有键

GetObjectInfo 参数1 键值
返回对应键的所有信息查询项目根目录下所有文件返回满足信息的列表

GetObjectFilename参数1 键-值1 
返回满足对应键值组合的文件名




业务层
导入模块

普通文件是文件 创建者拥有rw 组用户拥有r 其他的r—

用户也是文件拥有三种权限 向用户写入 读取用户 写入用户就是修改用户的信息

比如修改个人信息

管理员的组为 0 ID为0 拥有对任何文件的rwx 但是对关键文件的修改会记入到日志

导入
源文件 目标文件 标准格式 源文件的操作函数
有时间源文件不合法 就是格式与目标文件不对应 我们就可以通过操作函数实现对目标文件的格式化 

考勤逻辑如下:

为了简化考勤的操作 对考勤进行简化 不对数据的有效性进行分析 假设数据全是有效的 不对时间进行分析假设时间全是有效的 具体的验证放到业务校验模块
业务校验模块是与界面层的接口

要考勤就要有载体单独存储考勤信息 每当有用户开始考勤或者考勤截止就要独立于主程序之外进行操作

老师开始考勤时 首先输入教师ID判断该教师是否存在 若存在则输入课程和教授的班级ID若两者任意一环失败则表示操作失败 然后记录该次的考勤时间 判断当前是否可以考勤 在判断该课头是否已经被考勤 若两者任意一环失败该用例结束 若操作成功追加seq表 该教师的此次考勤信息 并把该次的考勤记录追加到考勤队列中
该考勤队列的信息如下
以老师ID为键 以班级和课程ID为键组成的字典为 值 作为结点元素  创建一个线程　先让他挂起　挂起时间取决于距离下课时间的范围　当到达结束时间时　对指定文件进行操作　计算结果写入文本　线程需要的参数为　　需要写入的文件名　以及需要挂起的时间　2个参数

手动考勤　自动考勤　随机考勤　

自动考勤和随机考勤都会自动持续到下课
自动考勤时可以进行随机考勤　
自动考勤　和　手动考勤会生成考勤文件
两者不同同时出现手动考勤必须在非上课时间内进行

所以随机考勤的内容直接加入到自动考勤的文件里面　就不用单独给随机考勤新的文件名

自动考勤在最后59秒内无法开启　这是由于在最后1分钟内学生很难进行有效的验证　由于时间紧迫出错的可能性很大　但是在下课后到下节课的上课前可以进行手动考勤　手动考勤不需要添加时间窗口　

对于自动考勤需要设置窗口关闭时间　默认是到下课　所以对于每一个开始的窗口都要记录他的开始时间当做参考点才能进行计算　


对于随机考勤来说是可以重复开启的　但是必须在自动考勤开始之后　可以在开一一个随机窗口之后再次开启一个随机窗口　为了保存之前考勤窗口的信息的同时打开新的随机窗口　需要设置一个变量　首先创建一个线程　把初始的变量赋值给他后开始挂起　之后若有新的随机窗口出现　那么变量加１　这样之前的线程终止休眠之后　发现已有的变量和之前的变量不一样　就会直接退出而不用写入数据　这是因为每当开启新新的随机窗口都会判断此时随机窗口的状态　若不存在或者为假时直接创建　但是若存在一个随机窗口则需要保存此时的数据　并修改变量的值


但是可以使用手动考勤

判断一个学生迟不迟到的关键因素在于判断他在验证有效期的行为
老师开始考勤时判断此时是否可以考勤　判断的依据就是　必须在上课十分钟之后和下课之前的一分钟内
也就是给定时间　判断该时间是否在有效的时间内　因为对时分秒比对起来很麻烦　统一使用秒制　对于满足要求的时间段进行筛选

通过循环判断　当前哪个时间段符合　此时的考勤时间　若符合　写出此时是第几节课　距离下课的时间　距离上课的时间　把这些信息作为字典返回


创建一个老师日志    专门记录该老师的各种设置信息 老师可自定义考勤规则


开启微信后，“考勤”默认为关闭的状态，需要老师登录微信后台，在“开启考勤”项目中设置启用。
按天查询，可查看学生签到和签退的时间，上课时长以及上课心情，并根据签到和签退的时间判断上课是否迟到或早退。
⑵.按月查询，可查看一个班全体员工在这一个月内的考勤记录，理论工作日和实际工作日，签到，迟到、早退次数。

创建一个日志 专门记录每个老师的括考勤规则      

事假应在前一日下午10点前申请，经老师查实认可并核准后方为有效

当然可按照老师指定的规则 由老师自行决断 

详细设计如下:

考勤的关键在于确定学生提交信息和提交时间并对信息和时间的有效性进行检验

对信息的检验由于硬件或者技术问题暂用产生随机数的方法判断信息是否有效

能做的就是对时间的把握

如何对时间进行把握

对时间进行处理就需要相应的规则 没有对应的规则作为依靠 就没有判断的基础

判断规则

凡是在开启自动考勤配置信息指定的分钟以后不到者记为缺勤 在开始考勤之后的限定时间没到可记为迟到        

未事先办理请假手续而无故缺勤；或请假未经批准私自休假者；各种假期愈期不归，又无续假手续者；或采取不正当手段，涂改、骗取、伪造休假证明者；或违纪、违规行为造成的缺勤；或未办完离职手续而擅自离职的，视为缺勤。

请假者请自行插入假条到某一具体考勤细节表中 系统记录提交时间

无法考勤者需向老师当场汇报 老师在考勤后手动维护该学生的记录 否则按缺勤处理


若要修改则使用不同的考勤规则

对应的考勤细节表可以表现为

学生WechatID 考勤类型(响应的考勤类型 自动 随机 手动 请假) 考勤开始时间 考勤记录时间  证据是否有效 考勤证据 考勤认证结果  

关于老师自定义规则流程如下：

规定开始考勤后A分钟定义为 迟到 B分钟后定义为缺勤  并附带上教师的wechatID 创建csv文件
形式如下
 默认是自动存在第一条记录
wechatid autolate AutoNone randomlate randomnone 

在老师开始考勤后显示 当前考勤类型 考勤规则 当前被考勤的人数 被考勤的班级 课的类型 考勤有效截止时间 以及考勤的结束时间 挂起一秒刷新状态 知道老师确定为止 这是为了让教师明确他此举的意义所在避免教师盲目考勤










